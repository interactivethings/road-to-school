<!DOCTYPE html>
<meta charset="utf-8">
<style>

body { 
  margin: 0; 
}
svg 
{
  position: absolute;
  top: 0;
  left: 0;
}
rect { 
  fill: transparent; 
}

canvas {
  position: absolute;
}

button {
  margin: 600px 60px ;
}
</style>
<canvas width="600" height="400"></canvas>
<!-- <button>stop</button> -->
<script src="https://d3js.org/d3.v4.min.js"></script>

<script>


var map = {};
map.width = 1080;
map.height = 500;
var Ndrop = 66;
var Nstay = 34;

map.canvas =
  d3.select('body')
    .append('canvas')
      .attr('width', map.width)
      .attr('height', map.height)
      .node().getContext('2d');

map.svg =
  d3.select('body')
    .append('svg')
      .attr('width', map.width)
      .attr('height', map.height)
      .append('g');

map.svg.append('rect')
  .attr('class', 'overlay')
  .attr('width', map.width)
  .attr('height', map.height);


map.canvas.nodesDrop= d3.range(Ndrop).map(function() {
  var x = map.width * Math.random(),
      y =  40*Math.random();
  return { 
    x: x, 
    y: y 
  }
});

map.canvas.nodesStay= d3.range(Nstay).map(function() {
  var x = map.width * Math.random(),
      y =  40*Math.random();
  return { 
    x: x, 
    y: y 
  }
});

var simulationDrop = d3.forceSimulation(map.canvas.nodesDrop)
    .alphaTarget(0.4)
    .velocityDecay(0.5)
    // .force("charge", d3.forceManyBody().strength(0.1).distanceMax(1))
    .force("Y", d3.forceY().strength(-0.03))
    // .force("collide", d3.forceCollide().radius(0.9).strength(0.1))

simulationDrop.on("tick", drop);


map.svg.append("text")
  .style("fill", "black")
  .style("font-family", "Helvetica Neue")
  .style("font-weight", "300")
  .style("font-size", "30")
  .style("text-anchor", "middle")
  .text("  syrian refugee children can't wait to go back to school tomorrow" )
  .attr("x", map.width/2)
  .attr("y", map.height - 100);

function drop() {
  map.canvas.clearRect(0, 0, map.width, map.height);
  map.svg.selectAll("text.counter").remove();
  map.canvas.strokeStyle = '#3B6C73';

  map.svg.append("text")
  .attr("class","counter")
  .style("fill", "black")
  .style("font-family", "Helvetica Neue")
  .style("font-weight", "300")
  .style("font-size", "30")
  .style("text-anchor", "middle")
  // .text(counterReturn)
  .attr("x", map.width/2)
  .attr("y", map.height - 150);


  for (var i = 0, node; i < Ndrop; ++i) {
    //drawing all the dots at every tick
    node = map.canvas.nodesDrop[i];
    //dots touch the bottom
    if ( node.y > map.height ) 
    { 
      // send them back
      node.y = 0;
      node.x = node.x;
    }
    else {

    }
    map.canvas.beginPath();
    map.canvas.arc(node.x,node.y, 1, 0, 2*Math.PI);
    map.canvas.stroke();
    stay();
  }
}

function stay() {
  // map.canvas.clearRect(0, 0, map.width, map.height);
  for (var i = 0, node; i < Nstay; ++i) {
      node = map.canvas.nodesStay[i];
      map.canvas.beginPath();
      map.canvas.arc(node.x,node.y, 10, 0, 2*Math.PI);
      map.canvas.stroke();
    }
}

function counterReturn() {
  return Math.floor(Math.random()*100);
}



</script>
