<!DOCTYPE html>
<meta charset="utf-8">
<style>
body { 
  margin: 0; 
}
svg 
{
  position: absolute;
  top: 0;
  left: 0;
}
button {
  margin: 10px 0px 0px 10px;
}
</style>
<body>
  <button id="first">click me!</button>
  <button id="second">no, click me!</button>
  <div style="position: relative">
    <div id="canvas"></div>
    <div id="svg"></div>
  </div>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script>


  /* Configuration
  ----------------------------------------------- */
  var config = { 
    n: 1000, 
    width: 1080, 
    height: 500, 
    algoMap: [ 
      {
      t: 0,
      algo: algo1
      },
      {
        t: 60,
        algo: algo2
      }
    ]
  };
  var canvas = d3.select('#canvas')
    .append('canvas')
    .attr('width', config.width)
    .attr('height', config.height)
    .node().getContext('2d');

  var svg = d3.select('#svg')
    .append('svg')
  .attr('width', config.width )
  .attr('height', config.height + 100)
  .append('g');


  /* State initialization
  ----------------------------------------------- */
  var makeInitialState = function(config) {
      var state = {
        data: d3.range(config.n).map(function() 
              {
                return { 
                  x: config.width * Math.random(), 
                  y: 10*Math.random(),
                  vx: 0,
                  vy: 0,
                  moredata: {
                    type: Math.floor(Math.random() + 0.5),
                    text: "story of a student!",
                    age: 0,
                    country: "Syria"
                  }
                }
              }),
        timeSinceStart: 0,
        width: config.width,
        height: config.height,
        selectedAlgorithm: identity  /* we initialize this with the identity algorithm*/
      };
      return state;
  };
  

    /* Algorithm definitions
  ----------------------------------------------- */
  var algo1 = function(state) {
    var sim = d3.forceSimulation(state.data)
      .alphaTarget(0.9)
      .velocityDecay(0.5)
      .force("Y", d3.forceY().strength(-0.07))
      .stop()
    sim.tick();
    return state;
  }

  var algo2 = function(state) {
    var sim = d3.forceSimulation(state.data)
      .alphaTarget(0.9)
      .velocityDecay(0.5)
      .force("Y", d3.forceY().strength(0.1))
      .stop()
    sim.tick();
    return state;
  }
  

  /* Update state
  ----------------------------------------------- */
  var updateState = function(state) {
    // return state;
    return identity;
  }

  /* Choose algorithm function
  ----------------------------------------------- */
  var chooseAlgo = function(state, time) {
    // //if elapsed time reaches 60 - apply opposite force
    // var algosWithinTime = config.algoMap.filter(function(d) {
    //   return d.t < time;
    // });
    // var lastAlgo = algosWithinTime[algosWithinTime.length - 1];
    // return lastAlgo ? lastAlgo : config.algoMap[config.algoMap.length - 1];

    return identity;

  }


  /* Render
  ----------------------------------------------- */
  function render(state, canvas, svg, actions) {

    d3.select("#first").on('click', function() { /* the first button was clicked */
      //will select the algorithm according to the button clicked
      console.log("click")       
      // var event = d3.event()  
      // actions.onSelectAlgorithm( apply the algorithm and return the state)
    });

    canvas.clearRect(0, 0, state.width, state.height);
    for (var i = 0, node; i < state.data.length; ++i) {
      node = state.data[i];
      canvas.beginPath();
      canvas.arc(node.x,node.y, 3, 0, 2*Math.PI);
      canvas.fillStyle = '#3B6C73';
      canvas.fill();
    }
  }



  // Main loop
  (function (state, time, canvas, svg, config) {
    function main() {
      //advance timer
      ++time; 

      // // update the current state (using events and actions from HTML)
      // state = updateState(state);
      // // choose algorithm according to which point we are in the timeline
      // var algo = chooseAlgo(state, time);
      // // apply algorithm to state 
      // state = algo(state);

      render(state, canvas, svg, { /* the actions object is passed to the render function */
        onSelectAlgorithm: function(selectedAlgorithm /* = "fallDown" */) {
          state.selectedAlgorithm = selectedAlgorithm;
        }
      });
    };

    d3.interval(main, 1000);

  })(makeInitialState(config), 0, canvas, svg, config);


  /* Helper functions
  ----------------------------------------------- */
  var identity = function(x) { return x; };

  </script>
</body>